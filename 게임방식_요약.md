# 쿠키 배틀 게임 방식 요약

## 핵심 개념

### 왜 "변화량" 기반인가?
- **보유량 기준 게임의 문제**: 쿠키 많은 학생이 항상 유리 → 쿠키 적은 학생 동기 저하
- **변화량 기준 게임의 장점**: 지금 쿠키가 적어도 열심히 하면 게임에서 유리 → 모든 학생 동기 부여

---

## 게임 흐름

### 1단계: 팀 구성 (교사)
- 기본 **4인 1조** (3~5명 조절 가능)
- 자동 랜덤 배정 또는 수동 배정
- 팀 이름, 팀 이모지 설정

### 2단계: 쿠키 축적 기간
- 팀 구성 후 ~ 게임 시작 전까지 (보통 1~2주)
- 학생들이 다했니 앱에서 학습하며 쿠키 획득
- 이 기간 동안의 **쿠키 변화량**이 게임 자원이 됨

### 3단계: 게임 진행 (교사가 원하는 시점에)
- 교사가 게임 시작 버튼 클릭
- 각 팀의 쿠키 변화량 합산 → 팀 자원
- 배팅 → 전투 → 결과 (여러 라운드)

---

## 팀 자원 계산

```
팀 자원 = Σ(각 팀원의 쿠키 변화량)

쿠키 변화량 = 현재 쿠키 - 이전 쿠키
```

### 예시
| 팀원 | 현재쿠키 | 이전쿠키 | 변화량 |
|------|---------|---------|--------|
| 홍길동 | 150 | 100 | +50 |
| 김철수 | 80 | 60 | +20 |
| 이영희 | 200 | 180 | +20 |
| 박민수 | 50 | 30 | +20 |
| **팀 합계** | | | **+110** |

→ 이 팀은 110 쿠키로 게임 시작

---

## 배틀 메커니즘

### 배팅 단계
각 팀이 보유 쿠키를 **공격**과 **방어**에 배분

```
팀 자원 = 공격 쿠키 + 방어 쿠키
```

### 승률 계산
```
승률 = 공격쿠키 / (공격쿠키 + 상대 방어쿠키) × 100

제한: 최소 10% ~ 최대 90%
```

### 예시
- A팀이 B팀 공격: 공격 60 vs 방어 40 → 승률 60%
- A팀이 B팀 공격: 공격 90 vs 방어 10 → 승률 90% (최대)
- A팀이 B팀 공격: 공격 10 vs 방어 90 → 승률 10% (최소)

### 승패 결정
1. 1~100 사이 주사위 굴림
2. 주사위 ≤ 승률 → 공격 성공
3. 주사위 > 승률 → 공격 실패

---

## 손실 메커니즘 (3가지 중 선택)

| 모드 | 승자 획득 | 패자 손실 | 특징 |
|------|----------|----------|------|
| **기본** ⚔️ | 상대 배팅의 30% | 배팅 전액 | 균형잡힌 게임 (권장) |
| **제로섬** 💀 | 상대 배팅 전액 | 배팅 전액 | 하이리스크 하이리턴 |
| **부드러운** 🌸 | 상대 배팅의 20% | 배팅의 50% | 손실 최소화 (초보용) |

### 방어 페널티
- 공격받지 않은 팀의 방어 쿠키 → 50% 손실
- "아무도 안 와서 쿠키가 상함"

---

## 게임 일정

- **교사가 자유롭게 결정** (자동 아님)
- 보통 1주~2주에 한 번
- 학사 일정에 맞게 조절 가능
- 시험 기간이면 건너뛰기 가능

---

## 보너스 시스템

### 성찰왕
- 교사가 매일/매주 성찰 잘 한 학생 선정
- 선정된 학생에게 보너스 쿠키 (기본 100)
- 해당 학생 팀에도 보너스 추가

### 미성찰 페널티
- 한 번도 성찰 안 한 학생 페널티
- 팀 자원에서 차감

---

## 잔디 시스템 (학습 기록)

### 목적
- GitHub 잔디처럼 일일 학습 현황 시각화
- 쿠키 변화량을 날짜별로 기록

### 새로고침
- 교사가 "쿠키 새로고침" 버튼 클릭
- 다했니 API에서 현재 쿠키 조회
- 변화량 계산 후 잔디에 기록
- 이전쿠키 = 현재쿠키로 업데이트

### 같은 날 여러 번 새로고침
- 첫 번째: `2024-11-28`
- 두 번째: `2024-11-28(2)`
- 세 번째: `2024-11-28(3)`
- 여러 번 = 진한 잔디 (더 열심히 함)

---

## 데이터 저장 위치

### Google Sheets 시트 구조
```
{학급}_학생: 학생 정보, 쿠키, 프로필
{학급}_팀: 팀 구성, 팀원, 팀 쿠키
{학급}_잔디: 날짜별 쿠키 변화량
{학급}_소원: 소원의 돌
{학급}_전투: 배틀 기록
```

### 학생 시트 주요 컬럼
- D열: 쿠키 (현재)
- H열: 이전쿠키 (변화량 계산 기준점)

---

## 한 줄 요약

> **"쿠키 보유량이 아닌 변화량으로 게임하여, 쿠키가 적은 학생도 열심히 하면 게임에서 이길 수 있다"**
