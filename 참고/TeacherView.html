<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    :root {
      --bg-primary: #1a2d42;
      --bg-secondary: rgba(35, 55, 80, 0.98);
      --bg-header: rgba(26, 45, 66, 0.95);
      --text-primary: #ffffff;
      --text-secondary: #a0b0c0;
      --border-color: rgba(255,255,255,0.12);
      --card-bg: rgba(255,255,255,0.08);
      --accent-start: #2d4a6f;
      --accent-end: #1a2d42;
    }
    
    .light-mode {
      --bg-primary: #f5f7fa;
      --bg-secondary: #ffffff;
      --bg-header: rgba(255, 255, 255, 0.95);
      --text-primary: #1a1a2e;
      --text-secondary: #666666;
      --border-color: rgba(0,0,0,0.1);
      --card-bg: rgba(0,0,0,0.05);
    }
    
    body {
      font-family: 'Noto Sans KR', sans-serif;
      background: var(--bg-primary);
      min-height: 100vh;
      color: var(--text-primary);
      overflow: hidden;
      transition: background 0.3s ease, color 0.3s ease;
    }
    
    /* í—¤ë” */
    .header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 70px;
      background: var(--bg-header);
      backdrop-filter: blur(10px);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 30px;
      z-index: 100;
      border-bottom: 1px solid var(--border-color);
      transition: background 0.3s ease;
    }
    
    .header-left {
      display: flex;
      align-items: center;
      gap: 20px;
    }
    
    .logo {
      font-size: 28px;
    }
    
    .session-info h1 {
      font-size: 20px;
      font-weight: 600;
    }
    
    .session-code {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: linear-gradient(135deg, var(--accent-start) 0%, var(--accent-end) 100%);
      padding: 8px 16px;
      border-radius: 8px;
      font-size: 18px;
      font-weight: 700;
      letter-spacing: 3px;
      color: white;
    }
    
    .header-right {
      display: flex;
      align-items: center;
      gap: 20px;
    }
    
    .stats {
      display: flex;
      gap: 25px;
    }
    
    .stat-item {
      text-align: center;
    }
    
    .stat-value {
      font-size: 28px;
      font-weight: 700;
      background: linear-gradient(135deg, #5a8cbe 0%, #3d6a99 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .stat-label {
      font-size: 12px;
      color: var(--text-secondary);
    }
    
    .controls {
      display: flex;
      gap: 10px;
    }
    
    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: 'Noto Sans KR', sans-serif;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, var(--accent-start) 0%, var(--accent-end) 100%);
      color: white;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(45, 74, 111, 0.4);
    }
    
    .btn-secondary {
      background: var(--card-bg);
      color: var(--text-primary);
    }
    
    .btn-secondary:hover {
      background: rgba(45, 74, 111, 0.3);
    }
    
    .btn-danger {
      background: #c0392b;
      color: white;
    }
    
    .btn-danger:hover {
      background: #a93226;
    }
    
    .btn-icon {
      width: 40px;
      height: 40px;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      border-radius: 8px;
    }
    
    /* ë©”ì¸ ì½˜í…ì¸  */
    .main-content {
      padding-top: 70px;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    #wordcloud-container {
      width: 100%;
      height: calc(100vh - 110px);
      position: relative;
    }
    
    #wordcloud-svg {
      width: 100%;
      height: 100%;
    }
    
    /* ì„¸ì…˜ ì—†ìŒ í™”ë©´ */
    .no-session {
      display: flex;
      align-items: center;
      justify-content: center;
      height: calc(100vh - 110px);
      padding: 40px;
    }
    
    .no-session-card {
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: 24px;
      padding: 50px 60px;
      text-align: center;
      max-width: 420px;
      backdrop-filter: blur(10px);
    }
    
    .no-session-icon {
      width: 80px;
      height: 80px;
      margin: 0 auto 24px;
      background: linear-gradient(135deg, #5a8cbe 0%, #3d6a99 100%);
      border-radius: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 40px;
    }
    
    .no-session h2 {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 12px;
      color: var(--text-primary);
    }
    
    .no-session p {
      color: var(--text-secondary);
      font-size: 15px;
      line-height: 1.6;
      margin-bottom: 28px;
    }
    
    .btn-start {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      background: linear-gradient(135deg, var(--accent-start) 0%, var(--accent-end) 100%);
      color: white;
      border: none;
      border-radius: 12px;
      padding: 14px 32px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: 'Noto Sans KR', sans-serif;
    }
    
    .btn-start:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 30px rgba(45, 74, 111, 0.4);
    }
    
    .btn-start .btn-icon-emoji {
      font-size: 18px;
    }
    
    /* ëŒ€ê¸° í™”ë©´ */
    .waiting-screen {
      text-align: center;
      animation: pulse 2s ease-in-out infinite;
    }
    
    .waiting-screen .icon {
      font-size: 100px;
      margin-bottom: 20px;
    }
    
    .waiting-screen h2 {
      font-size: 28px;
      color: var(--text-secondary);
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 0.6; }
      50% { opacity: 1; }
    }
    
    /* ëª¨ë‹¬ */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }
    
    .modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }
    
    .modal {
      background: white;
      border-radius: 24px;
      padding: 40px;
      text-align: center;
      color: #333;
      max-width: 450px;
      transform: scale(0.9);
      transition: transform 0.3s ease;
    }
    
    .modal-overlay.active .modal {
      transform: scale(1);
    }
    
    .modal h3 {
      font-size: 24px;
      margin-bottom: 10px;
    }
    
    .modal .session-title {
      color: #666;
      margin-bottom: 25px;
    }
    
    .qr-code {
      width: 200px;
      height: 200px;
      background: #f5f5f5;
      margin: 0 auto 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 12px;
    }
    
    .qr-code img {
      width: 180px;
      height: 180px;
    }
    
    .modal .code-display {
      font-size: 36px;
      font-weight: 700;
      color: #2d4a6f;
      letter-spacing: 6px;
      margin: 20px 0;
    }
    
    .modal .url-display {
      font-size: 12px;
      color: #888;
      word-break: break-all;
      background: #f5f5f5;
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    
    .modal .btn {
      margin: 5px;
    }
    
    .modal .btn-secondary {
      background: #e0e0e0;
      color: #333;
    }
    
    .modal .btn-secondary:hover {
      background: #d0d0d0;
    }
    
    .modal input[type="text"] {
      width: 100%;
      padding: 15px;
      font-size: 16px;
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      margin: 20px 0;
      font-family: 'Noto Sans KR', sans-serif;
    }
    
    /* ì„¤ì • íŒ¨ë„ */
    .settings-panel {
      position: fixed;
      top: 70px;
      right: -380px;
      width: 380px;
      height: calc(100vh - 70px);
      background: var(--bg-secondary);
      padding: 30px;
      transition: right 0.3s ease, background 0.3s ease;
      z-index: 99;
      overflow-y: auto;
      border-left: 1px solid var(--border-color);
    }
    
    .settings-panel.active {
      right: 0;
    }
    
    .settings-panel h3 {
      margin-bottom: 25px;
      font-size: 20px;
    }
    
    .setting-group {
      margin-bottom: 25px;
    }
    
    .setting-group label {
      display: block;
      margin-bottom: 10px;
      font-size: 14px;
      color: var(--text-secondary);
    }
    
    .setting-group select,
    .setting-group input[type="range"] {
      width: 100%;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid var(--border-color);
      background: var(--card-bg);
      color: var(--text-primary);
      font-size: 14px;
    }
    
    .setting-group input[type="range"] {
      padding: 0;
      height: 8px;
      -webkit-appearance: none;
      background: var(--card-bg);
    }
    
    .setting-group input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 20px;
      height: 20px;
      background: #3d6a99;
      border-radius: 50%;
      cursor: pointer;
    }
    
    .color-options {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
    }
    
    .color-option {
      width: 100%;
      aspect-ratio: 1;
      border-radius: 8px;
      cursor: pointer;
      border: 3px solid transparent;
      transition: all 0.3s ease;
    }
    
    .color-option:hover {
      transform: scale(1.1);
    }
    
    .color-option.active {
      border-color: var(--text-primary);
    }
    
    /* ëª¨ë“œ í† ê¸€ */
    .mode-toggle {
      display: flex;
      background: var(--card-bg);
      border-radius: 8px;
      padding: 4px;
    }
    
    .mode-toggle button {
      flex: 1;
      padding: 10px;
      border: none;
      background: transparent;
      color: var(--text-secondary);
      cursor: pointer;
      border-radius: 6px;
      font-family: 'Noto Sans KR', sans-serif;
      font-size: 14px;
      transition: all 0.3s ease;
    }
    
    .mode-toggle button.active {
      background: linear-gradient(135deg, var(--accent-start) 0%, var(--accent-end) 100%);
      color: white;
    }
    
    /* ë‹¨ì–´ ëª©ë¡ */
    .word-list {
      max-height: 250px;
      overflow-y: auto;
      margin-top: 10px;
    }
    
    .word-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 0;
      border-bottom: 1px solid var(--border-color);
    }
    
    .word-item .word {
      font-weight: 500;
    }
    
    .word-item .count {
      background: rgba(45, 74, 111, 0.3);
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
    }
    
    /* í”Œë¡œíŒ… ë²„íŠ¼ë“¤ */
    .floating-buttons {
      position: fixed;
      bottom: 50px;
      right: 30px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      z-index: 50;
    }
    
    .floating-btn {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--accent-start) 0%, var(--accent-end) 100%);
      border: none;
      color: white;
      font-size: 20px;
      cursor: pointer;
      box-shadow: 0 5px 20px rgba(0,0,0,0.3);
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .floating-btn:hover {
      transform: scale(1.1);
    }
    
    /* ë¡œë”© í™”ë©´ */
    .loading-screen {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 20px;
    }
    
    .spinner {
      width: 50px;
      height: 50px;
      border: 4px solid var(--border-color);
      border-top-color: #3d6a99;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* ì›Œë“œ í´ë¼ìš°ë“œ ë‹¨ì–´ ìŠ¤íƒ€ì¼ */
    .word-text {
      cursor: default;
      transition: opacity 0.3s ease;
    }
    
    .word-text:hover {
      opacity: 0.7;
    }
    
    /* í‘¸í„° (ì¹´í”¼ë¼ì´íŠ¸) */
    .footer {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      padding: 10px;
      text-align: center;
      font-size: 11px;
      color: var(--text-secondary);
      background: var(--bg-header);
      border-top: 1px solid var(--border-color);
      z-index: 100;
    }
    
    .footer a {
      color: var(--text-primary);
      text-decoration: none;
      opacity: 0.8;
    }
    
    .footer a:hover {
      text-decoration: underline;
      opacity: 1;
    }
    
    /* ë°˜ì‘í˜• */
    @media (max-width: 900px) {
      .header {
        padding: 0 15px;
        height: 60px;
      }
      
      .stats {
        display: none;
      }
      
      .session-code {
        font-size: 14px;
        padding: 6px 12px;
      }
      
      .btn {
        padding: 8px 12px;
        font-size: 12px;
      }
      
      .main-content {
        padding-top: 60px;
      }
      
      #wordcloud-container {
        height: calc(100vh - 100px);
      }
    }
  </style>
</head>
<body class="light-mode">
  <header class="header" id="header">
    <div class="header-left">
      <span class="logo">â˜ï¸</span>
      <div class="session-info">
        <h1 id="sessionTitle">ì›Œë“œ í´ë¼ìš°ë“œ</h1>
      </div>
      <span class="session-code" id="sessionCodeDisplay">------</span>
    </div>
    
    <div class="header-right">
      <div class="stats">
        <div class="stat-item">
          <div class="stat-value" id="totalResponses">0</div>
          <div class="stat-label">ì´ ì‘ë‹µ</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="uniqueWords">0</div>
          <div class="stat-label">ê³ ìœ  ë‹¨ì–´</div>
        </div>
      </div>
      
      <div class="controls">
        <button class="btn btn-secondary" id="btnQR">ğŸ“± ì°¸ì—¬</button>
        <button class="btn btn-secondary" id="btnSave">ğŸ’¾ ì €ì¥</button>
        <button class="btn btn-secondary" id="btnSettings">âš™ï¸</button>
        <button class="btn btn-primary" id="btnNewSession">ğŸš€ ìƒˆ ì„¸ì…˜</button>
      </div>
    </div>
  </header>
  
  <div class="main-content">
    <div id="loadingView" class="loading-screen">
      <div class="spinner"></div>
      <p>ë¡œë”© ì¤‘...</p>
    </div>
    
    <div id="noSessionView" class="no-session" style="display: none;">
      <div class="no-session-card">
        <div class="no-session-icon">â˜ï¸</div>
        <h2>ì›Œë“œ í´ë¼ìš°ë“œ</h2>
        <p>ìƒˆ ì„¸ì…˜ì„ ì‹œì‘í•˜ì—¬<br>í•™ìƒë“¤ì˜ ìƒê°ì„ ëª¨ì•„ë³´ì„¸ìš”</p>
        <button class="btn-start" id="btnStartSession">
          <span class="btn-icon-emoji">ğŸš€</span>
          <span>ìƒˆ ì„¸ì…˜ ì‹œì‘í•˜ê¸°</span>
        </button>
      </div>
    </div>
    
    <div id="waitingView" class="waiting-screen" style="display: none;">
      <div class="icon">â³</div>
      <h2>ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘...</h2>
    </div>
    
    <div id="wordcloud-container" style="display: none;">
      <svg id="wordcloud-svg"></svg>
    </div>
  </div>
  
  <!-- QR ëª¨ë‹¬ -->
  <div class="modal-overlay" id="qrModal">
    <div class="modal">
      <h3>ğŸ“± í•™ìƒ ì°¸ì—¬ ì•ˆë‚´</h3>
      <p class="session-title" id="modalSessionTitle">ì„¸ì…˜ ì œëª©</p>
      <div class="qr-code" id="qrCode">
        <span style="color: #888;">QR ì½”ë“œ</span>
      </div>
      <div class="code-display" id="modalSessionCode">------</div>
      <div class="url-display" id="modalUrl">URL</div>
      <div>
        <button class="btn btn-primary" id="btnCopyLink">ğŸ”— ë§í¬ ë³µì‚¬</button>
        <button class="btn btn-secondary" id="btnCloseQR">ë‹«ê¸°</button>
      </div>
    </div>
  </div>
  
  <!-- ìƒˆ ì„¸ì…˜ ëª¨ë‹¬ -->
  <div class="modal-overlay" id="newSessionModal">
    <div class="modal">
      <h3>ğŸš€ ìƒˆ ì„¸ì…˜ ì‹œì‘</h3>
      <p class="session-title">ì›Œë“œ í´ë¼ìš°ë“œ ì£¼ì œë¥¼ ì…ë ¥í•˜ì„¸ìš”</p>
      <input type="text" id="newSessionTitle" placeholder="ì˜ˆ: í™˜ê²½ ë¬¸ì œ í•µì‹¬ í‚¤ì›Œë“œ">
      <div>
        <button class="btn btn-primary" id="btnCreateSession">ì„¸ì…˜ ì‹œì‘</button>
        <button class="btn btn-secondary" id="btnCloseNewSession">ì·¨ì†Œ</button>
      </div>
    </div>
  </div>
  
  <!-- ì„¤ì • íŒ¨ë„ -->
  <div class="settings-panel" id="settingsPanel">
    <h3>âš™ï¸ ì„¤ì •</h3>
    
    <!-- QR ì½”ë“œ ì„¹ì…˜ -->
    <div class="setting-group" id="settingsQRSection" style="display: none;">
      <label>ğŸ“± ì°¸ì—¬ QR ì½”ë“œ</label>
      <div style="text-align: center; background: white; border-radius: 12px; padding: 15px;">
        <div id="settingsQRCode" style="margin-bottom: 10px;"></div>
        <div id="settingsSessionCode" style="font-size: 20px; font-weight: 700; color: #2d4a6f; letter-spacing: 4px;"></div>
      </div>
    </div>
    
    <div class="setting-group">
      <label>í™”ë©´ ëª¨ë“œ</label>
      <div class="mode-toggle">
        <button id="btnDarkMode">ğŸŒ™ ë‹¤í¬</button>
        <button id="btnLightMode" class="active">â˜€ï¸ ë¼ì´íŠ¸</button>
      </div>
    </div>
    
    <div class="setting-group">
      <label>ìƒ‰ìƒ í…Œë§ˆ</label>
      <div class="color-options" id="colorOptions">
        <div class="color-option active" style="background: linear-gradient(135deg, #667eea, #764ba2);" data-theme="purple"></div>
        <div class="color-option" style="background: linear-gradient(135deg, #f093fb, #f5576c);" data-theme="pink"></div>
        <div class="color-option" style="background: linear-gradient(135deg, #4facfe, #00f2fe);" data-theme="blue"></div>
        <div class="color-option" style="background: linear-gradient(135deg, #43e97b, #38f9d7);" data-theme="green"></div>
        <div class="color-option" style="background: linear-gradient(135deg, #fa709a, #fee140);" data-theme="sunset"></div>
        <div class="color-option" style="background: linear-gradient(135deg, #ff6b6b, #ffa502);" data-theme="orange"></div>
        <div class="color-option" style="background: linear-gradient(135deg, #a8edea, #fed6e3);" data-theme="pastel"></div>
        <div class="color-option" style="background: #333;" data-theme="mono"></div>
      </div>
    </div>
    
    <div class="setting-group">
      <label>ê¸€ì í¬ê¸°: <span id="fontSizeValue">1.0</span>x</label>
      <input type="range" id="fontSizeSlider" min="0.5" max="2" step="0.1" value="1">
    </div>
    
    <div class="setting-group">
      <label>ìƒˆë¡œê³ ì¹¨ ê°„ê²©</label>
      <select id="refreshInterval">
        <option value="2000">2ì´ˆ</option>
        <option value="3000" selected>3ì´ˆ</option>
        <option value="5000">5ì´ˆ</option>
        <option value="10000">10ì´ˆ</option>
      </select>
    </div>
    
    <div class="setting-group">
      <label>ë‹¨ì–´ ëª©ë¡ (ìƒìœ„ 20ê°œ)</label>
      <div class="word-list" id="wordList">
        <p style="color: var(--text-secondary); text-align: center;">ë°ì´í„° ì—†ìŒ</p>
      </div>
    </div>
    
    <div class="setting-group">
      <button class="btn btn-secondary" id="btnClearData" style="width: 100%;">ğŸ—‘ï¸ ë°ì´í„° ì´ˆê¸°í™”</button>
      <button class="btn btn-danger" id="btnEndSession" style="width: 100%; margin-top: 10px;">â¹ï¸ ì„¸ì…˜ ì¢…ë£Œ</button>
    </div>
  </div>
  
  <!-- í”Œë¡œíŒ… ë²„íŠ¼ -->
  <div class="floating-buttons">
    <button class="floating-btn" id="btnFullscreen" title="ì „ì²´í™”ë©´">â›¶</button>
  </div>
  
  <!-- í‘¸í„° (ì¹´í”¼ë¼ì´íŠ¸) -->
  <footer class="footer">
    â“’ 2025 ì¶©ë‚¨ì‚¼ì„±ê³ ë“±í•™êµ ê¹€ìš©í˜„T | <a href="mailto:cnsageo@cnsa.hs.kr">cnsageo@cnsa.hs.kr</a>
  </footer>

  <script>
    // =============================================
    // ìƒíƒœ ë³€ìˆ˜
    // =============================================
    var currentSession = null;
    var wordData = [];
    var refreshTimer = null;
    var refreshIntervalMs = 3000;
    var fontSizeMultiplier = 1;
    var currentTheme = 'purple';
    var isDarkMode = false;
    var wordPositions = {};
    var svgWidth = 0;
    var svgHeight = 0;
    
    // ìƒ‰ìƒ í…Œë§ˆ
    var colorThemes = {
      purple: ['#667eea', '#764ba2', '#f093fb', '#f5576c', '#c471f5', '#fa71cd'],
      pink: ['#f093fb', '#f5576c', '#ff6b95', '#ff8c94', '#ffa8a8', '#e056fd'],
      blue: ['#4facfe', '#00f2fe', '#43e97b', '#38f9d7', '#667eea', '#00c6ff'],
      green: ['#43e97b', '#38f9d7', '#0cebeb', '#20e3b2', '#29ffc6', '#00f260'],
      sunset: ['#fa709a', '#fee140', '#f7971e', '#ffd200', '#ff6b6b', '#feca57'],
      orange: ['#ff6b6b', '#ffa502', '#ff7675', '#fdcb6e', '#e17055', '#fab1a0'],
      pastel: ['#a8edea', '#fed6e3', '#ffecd2', '#fcb69f', '#d4fc79', '#96e6a1'],
      mono: ['#ffffff', '#e0e0e0', '#bdbdbd', '#9e9e9e', '#757575', '#616161']
    };
    
    var colorThemesLight = {
      purple: ['#5a67d8', '#6b46c1', '#d53f8c', '#9f7aea', '#805ad5', '#b794f4'],
      pink: ['#d53f8c', '#ed64a6', '#f687b3', '#b83280', '#97266d', '#d53f8c'],
      blue: ['#3182ce', '#2b6cb0', '#2c5282', '#4299e1', '#63b3ed', '#0987a0'],
      green: ['#38a169', '#2f855a', '#276749', '#48bb78', '#68d391', '#25855a'],
      sunset: ['#dd6b20', '#c05621', '#9c4221', '#ed8936', '#f6ad55', '#c53030'],
      orange: ['#c53030', '#dd6b20', '#d69e2e', '#e53e3e', '#ed8936', '#f6ad55'],
      pastel: ['#68d391', '#fc8181', '#f6ad55', '#63b3ed', '#b794f4', '#f687b3'],
      mono: ['#1a202c', '#2d3748', '#4a5568', '#718096', '#a0aec0', '#cbd5e0']
    };
    
    // =============================================
    // ì´ˆê¸°í™”
    // =============================================
    document.addEventListener('DOMContentLoaded', function() {
      initEventListeners();
      loadSession();
    });
    
    function initEventListeners() {
      // ë²„íŠ¼ ì´ë²¤íŠ¸
      document.getElementById('btnQR').addEventListener('click', showQRModal);
      document.getElementById('btnSave').addEventListener('click', saveAsPNG);
      document.getElementById('btnSettings').addEventListener('click', toggleSettings);
      document.getElementById('btnNewSession').addEventListener('click', showNewSessionModal);
      document.getElementById('btnStartSession').addEventListener('click', showNewSessionModal);
      document.getElementById('btnCopyLink').addEventListener('click', copyLink);
      document.getElementById('btnCloseQR').addEventListener('click', function() { closeModal('qrModal'); });
      document.getElementById('btnCreateSession').addEventListener('click', createNewSession);
      document.getElementById('btnCloseNewSession').addEventListener('click', function() { closeModal('newSessionModal'); });
      document.getElementById('btnClearData').addEventListener('click', clearData);
      document.getElementById('btnEndSession').addEventListener('click', endCurrentSession);
      document.getElementById('btnFullscreen').addEventListener('click', toggleFullscreen);
      
      // ëª¨ë“œ í† ê¸€
      document.getElementById('btnDarkMode').addEventListener('click', function() { setDisplayMode('dark'); });
      document.getElementById('btnLightMode').addEventListener('click', function() { setDisplayMode('light'); });
      
      // ì„¤ì •
      document.getElementById('fontSizeSlider').addEventListener('input', updateFontSize);
      document.getElementById('refreshInterval').addEventListener('change', updateRefreshInterval);
      
      // ìƒ‰ìƒ ì˜µì…˜
      document.querySelectorAll('.color-option').forEach(function(el) {
        el.addEventListener('click', function() {
          setTheme(this.getAttribute('data-theme'));
        });
      });
      
      // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­
      document.querySelectorAll('.modal-overlay').forEach(function(modal) {
        modal.addEventListener('click', function(e) {
          if (e.target === this) {
            this.classList.remove('active');
          }
        });
      });
      
      // ìœˆë„ìš° ë¦¬ì‚¬ì´ì¦ˆ
      window.addEventListener('resize', debounce(function() {
        if (wordData.length > 0) {
          renderWordCloud({ words: wordData, total: wordData.reduce(function(sum, w) { return sum + w[1]; }, 0) });
        }
      }, 300));
    }
    
    // =============================================
    // ì„¸ì…˜ ê´€ë¦¬
    // =============================================
    var currentStudentUrl = '';
    
    function loadSession() {
      google.script.run
        .withSuccessHandler(handleSessionInfo)
        .withFailureHandler(handleError)
        .getSessionInfo();
    }
    
    function handleSessionInfo(info) {
      document.getElementById('loadingView').style.display = 'none';
      
      if (info && info.active) {
        currentSession = info;
        currentStudentUrl = info.studentUrl || '';
        document.getElementById('sessionTitle').textContent = info.title;
        document.getElementById('sessionCodeDisplay').textContent = info.code;
        document.getElementById('totalResponses').textContent = info.totalResponses;
        document.getElementById('uniqueWords').textContent = info.uniqueWords;
        
        document.getElementById('noSessionView').style.display = 'none';
        
        if (info.totalResponses > 0) {
          document.getElementById('waitingView').style.display = 'none';
          document.getElementById('wordcloud-container').style.display = 'block';
          loadWordData();
        } else {
          document.getElementById('waitingView').style.display = 'flex';
          document.getElementById('wordcloud-container').style.display = 'none';
        }
        
        startAutoRefresh();
      } else {
        currentSession = null;
        currentStudentUrl = '';
        document.getElementById('noSessionView').style.display = 'flex';
        document.getElementById('waitingView').style.display = 'none';
        document.getElementById('wordcloud-container').style.display = 'none';
        stopAutoRefresh();
      }
    }
    
    function loadWordData() {
      if (!currentSession) return;
      
      google.script.run
        .withSuccessHandler(renderWordCloud)
        .withFailureHandler(handleError)
        .getWordCloudData(currentSession.code);
    }
    
    function showNewSessionModal() {
      document.getElementById('newSessionTitle').value = '';
      document.getElementById('newSessionModal').classList.add('active');
      document.getElementById('newSessionTitle').focus();
    }
    
    function createNewSession() {
      var title = document.getElementById('newSessionTitle').value || 'ì›Œë“œ í´ë¼ìš°ë“œ';
      
      google.script.run
        .withSuccessHandler(function(result) {
          closeModal('newSessionModal');
          wordPositions = {};
          
          // ì„¸ì…˜ ì •ë³´ë¥¼ ë°”ë¡œ ì„¤ì •
          currentSession = {
            code: result.sessionCode,
            title: result.title,
            totalResponses: 0,
            uniqueWords: 0
          };
          
          // ì„¸ì…˜ ì •ë³´ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ê¸° (studentUrl í¬í•¨)
          google.script.run
            .withSuccessHandler(function(info) {
              if (info && info.active) {
                currentSession = info;
                currentStudentUrl = info.studentUrl || '';
                document.getElementById('sessionTitle').textContent = info.title;
                document.getElementById('sessionCodeDisplay').textContent = info.code;
                document.getElementById('totalResponses').textContent = info.totalResponses;
                document.getElementById('uniqueWords').textContent = info.uniqueWords;
                
                document.getElementById('noSessionView').style.display = 'none';
                document.getElementById('waitingView').style.display = 'flex';
                document.getElementById('wordcloud-container').style.display = 'none';
                
                startAutoRefresh();
                
                // QR ëª¨ë‹¬ í‘œì‹œ
                showQRModal();
              }
            })
            .withFailureHandler(handleError)
            .getSessionInfo();
        })
        .withFailureHandler(handleError)
        .createSession(title);
    }
    
    function endCurrentSession() {
      if (!currentSession) return;
      if (!confirm('í˜„ì¬ ì„¸ì…˜ì„ ì¢…ë£Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
      
      google.script.run
        .withSuccessHandler(function() {
          wordPositions = {};
          loadSession();
        })
        .withFailureHandler(handleError)
        .endSession(currentSession.code);
    }
    
    function clearData() {
      if (!currentSession) return;
      if (!confirm('í˜„ì¬ ì„¸ì…˜ì˜ ëª¨ë“  ì‘ë‹µ ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
      
      google.script.run
        .withSuccessHandler(function(result) {
          alert(result.deletedCount + 'ê°œì˜ ì‘ë‹µì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
          wordPositions = {};
          loadSession();
        })
        .withFailureHandler(handleError)
        .clearCurrentSessionData(currentSession.code);
    }
    
    // =============================================
    // ì›Œë“œ í´ë¼ìš°ë“œ ë Œë”ë§ (SVG ê¸°ë°˜ ì• ë‹ˆë©”ì´ì…˜)
    // =============================================
    function renderWordCloud(data) {
      wordData = data.words;
      
      document.getElementById('totalResponses').textContent = data.total;
      document.getElementById('uniqueWords').textContent = data.words.length;
      
      updateWordList();
      
      if (data.words.length === 0) {
        document.getElementById('waitingView').style.display = 'flex';
        document.getElementById('wordcloud-container').style.display = 'none';
        return;
      }
      
      document.getElementById('waitingView').style.display = 'none';
      document.getElementById('wordcloud-container').style.display = 'block';
      
      var container = document.getElementById('wordcloud-container');
      var svg = document.getElementById('wordcloud-svg');
      
      svgWidth = container.offsetWidth;
      svgHeight = container.offsetHeight;
      
      svg.setAttribute('viewBox', '0 0 ' + svgWidth + ' ' + svgHeight);
      
      // ë°ì´í„° ì¤€ë¹„
      var maxCount = Math.max.apply(null, data.words.map(function(w) { return w[1]; }));
      var minSize = 18 * fontSizeMultiplier;
      var maxSize = 72 * fontSizeMultiplier;
      
      var colors = isDarkMode ? colorThemes[currentTheme] : colorThemesLight[currentTheme];
      
      var wordsToRender = data.words.slice(0, 80).map(function(item, index) {
        var word = item[0];
        var count = item[1];
        var size = minSize + (count / maxCount) * (maxSize - minSize);
        var color = colors[index % colors.length];
        
        return {
          text: word,
          count: count,
          size: size,
          color: color
        };
      });
      
      // ë‚˜ì„ í˜• ë°°ì¹˜ ê³„ì‚°
      calculatePositions(wordsToRender);
      
      // SVG ì—…ë°ì´íŠ¸ (ì• ë‹ˆë©”ì´ì…˜ ì ìš©)
      updateSVG(wordsToRender);
    }
    
    function measureTextWidth(text, fontSize) {
      var width = 0;
      for (var i = 0; i < text.length; i++) {
        var charCode = text.charCodeAt(i);
        if (charCode > 127) {
          width += fontSize * 0.95;
        } else {
          width += fontSize * 0.55;
        }
      }
      return width;
    }
    
    function calculatePositions(words) {
      var centerX = svgWidth / 2;
      var centerY = svgHeight / 2;
      var placedBoxes = [];
      var padding = 3; // ë‹¨ì–´ ê°„ ì—¬ë°± (ì‘ê²Œ)
      
      words.forEach(function(word, index) {
        var fontSize = word.size;
        var textWidth = measureTextWidth(word.text, fontSize);
        var textHeight = fontSize * 1.1;
        
        var placed = false;
        var angle = index * 0.5;
        var radius = 0;
        var spiralTightness = 5;
        var maxRadius = Math.min(svgWidth, svgHeight) * 0.45;
        var attempts = 0;
        var maxAttempts = 1500;
        
        while (!placed && attempts < maxAttempts) {
          var x = centerX + radius * Math.cos(angle);
          var y = centerY + radius * Math.sin(angle);
          
          var box = {
            x: x - textWidth / 2 - padding,
            y: y - textHeight / 2 - padding,
            width: textWidth + padding * 2,
            height: textHeight + padding * 2
          };
          
          var collision = false;
          
          if (box.x < 5 || box.x + box.width > svgWidth - 5 || 
              box.y < 5 || box.y + box.height > svgHeight - 5) {
            collision = true;
          }
          
          if (!collision) {
            for (var i = 0; i < placedBoxes.length; i++) {
              if (boxesOverlap(box, placedBoxes[i])) {
                collision = true;
                break;
              }
            }
          }
          
          if (!collision) {
            word.x = x;
            word.y = y + fontSize * 0.35;
            placedBoxes.push(box);
            placed = true;
          } else {
            angle += 0.2;
            radius = spiralTightness * angle / (2 * Math.PI);
            
            if (radius > maxRadius) {
              radius = 0;
              angle = Math.random() * Math.PI * 2;
              spiralTightness = Math.max(2, spiralTightness - 0.5);
            }
            
            attempts++;
          }
        }
        
        if (!placed) {
          word.x = -1000;
          word.y = -1000;
          word.hidden = true;
        }
      });
    }
    
    function boxesOverlap(a, b) {
      return !(a.x > b.x + b.width || 
               b.x > a.x + a.width || 
               a.y > b.y + b.height || 
               b.y > a.y + a.height);
    }
    
    function updateSVG(words) {
      var svg = document.getElementById('wordcloud-svg');
      
      var existingElements = {};
      var children = svg.querySelectorAll('text');
      children.forEach(function(el) {
        existingElements[el.getAttribute('data-word')] = el;
      });
      
      var processedWords = {};
      
      words.forEach(function(word) {
        if (word.hidden) return;
        
        processedWords[word.text] = true;
        
        if (existingElements[word.text]) {
          var el = existingElements[word.text];
          animateElement(el, {
            x: word.x,
            y: word.y,
            fontSize: word.size,
            fill: word.color
          });
        } else {
          var text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
          text.setAttribute('data-word', word.text);
          text.setAttribute('x', word.x);
          text.setAttribute('y', word.y);
          text.setAttribute('text-anchor', 'middle');
          text.setAttribute('dominant-baseline', 'middle');
          text.setAttribute('font-family', 'Noto Sans KR, sans-serif');
          text.setAttribute('font-weight', '700');
          text.setAttribute('font-size', word.size);
          text.setAttribute('fill', word.color);
          text.setAttribute('class', 'word-text');
          text.setAttribute('opacity', '0');
          text.textContent = word.text;
          svg.appendChild(text);
          
          (function(textEl) {
            setTimeout(function() {
              animateElement(textEl, { opacity: 1 });
            }, 50);
          })(text);
        }
      });
      
      Object.keys(existingElements).forEach(function(word) {
        if (!processedWords[word]) {
          var el = existingElements[word];
          animateElement(el, { opacity: 0 }, function() {
            if (el.parentNode) {
              el.parentNode.removeChild(el);
            }
          });
        }
      });
    }
    
    function animateElement(el, props, callback) {
      var duration = 800;
      var startTime = null;
      var startProps = {};
      
      if (props.x !== undefined) startProps.x = parseFloat(el.getAttribute('x')) || 0;
      if (props.y !== undefined) startProps.y = parseFloat(el.getAttribute('y')) || 0;
      if (props.fontSize !== undefined) startProps.fontSize = parseFloat(el.getAttribute('font-size')) || 16;
      if (props.opacity !== undefined) startProps.opacity = parseFloat(el.getAttribute('opacity'));
      if (isNaN(startProps.opacity)) startProps.opacity = 1;
      
      function animate(timestamp) {
        if (!startTime) startTime = timestamp;
        var progress = Math.min((timestamp - startTime) / duration, 1);
        var eased = easeOutCubic(progress);
        
        if (props.x !== undefined) {
          el.setAttribute('x', startProps.x + (props.x - startProps.x) * eased);
        }
        if (props.y !== undefined) {
          el.setAttribute('y', startProps.y + (props.y - startProps.y) * eased);
        }
        if (props.fontSize !== undefined) {
          el.setAttribute('font-size', startProps.fontSize + (props.fontSize - startProps.fontSize) * eased);
        }
        if (props.opacity !== undefined) {
          el.setAttribute('opacity', startProps.opacity + (props.opacity - startProps.opacity) * eased);
        }
        if (props.fill !== undefined) {
          el.setAttribute('fill', props.fill);
        }
        
        if (progress < 1) {
          requestAnimationFrame(animate);
        } else if (callback) {
          callback();
        }
      }
      
      requestAnimationFrame(animate);
    }
    
    function easeOutCubic(t) {
      return 1 - Math.pow(1 - t, 3);
    }
    
    function animateElement(el, props, callback) {
      var duration = 600;
      var startTime = null;
      var startProps = {};
      
      if (props.x !== undefined) startProps.x = parseFloat(el.getAttribute('x')) || 0;
      if (props.y !== undefined) startProps.y = parseFloat(el.getAttribute('y')) || 0;
      if (props.fontSize !== undefined) startProps.fontSize = parseFloat(el.getAttribute('font-size')) || 16;
      if (props.opacity !== undefined) startProps.opacity = parseFloat(el.getAttribute('opacity')) || 1;
      
      function animate(timestamp) {
        if (!startTime) startTime = timestamp;
        var progress = Math.min((timestamp - startTime) / duration, 1);
        var eased = easeOutCubic(progress);
        
        if (props.x !== undefined) {
          el.setAttribute('x', startProps.x + (props.x - startProps.x) * eased);
        }
        if (props.y !== undefined) {
          el.setAttribute('y', startProps.y + (props.y - startProps.y) * eased);
        }
        if (props.fontSize !== undefined) {
          el.setAttribute('font-size', startProps.fontSize + (props.fontSize - startProps.fontSize) * eased);
        }
        if (props.opacity !== undefined) {
          el.setAttribute('opacity', startProps.opacity + (props.opacity - startProps.opacity) * eased);
        }
        if (props.fill !== undefined) {
          el.setAttribute('fill', props.fill);
        }
        
        if (progress < 1) {
          requestAnimationFrame(animate);
        } else if (callback) {
          callback();
        }
      }
      
      requestAnimationFrame(animate);
    }
    
    function easeOutCubic(t) {
      return 1 - Math.pow(1 - t, 3);
    }
    
    // =============================================
    // PNG ì €ì¥
    // =============================================
    function saveAsPNG() {
      var svg = document.getElementById('wordcloud-svg');
      var container = document.getElementById('wordcloud-container');
      
      if (!svg || wordData.length === 0) {
        alert('ì €ì¥í•  ì›Œë“œ í´ë¼ìš°ë“œê°€ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      
      // SVGë¥¼ ìº”ë²„ìŠ¤ë¡œ ë³€í™˜
      var canvas = document.createElement('canvas');
      var scale = 2; // ê³ í•´ìƒë„
      canvas.width = container.offsetWidth * scale;
      canvas.height = container.offsetHeight * scale;
      
      var ctx = canvas.getContext('2d');
      ctx.scale(scale, scale);
      
      // ë°°ê²½ìƒ‰
      ctx.fillStyle = isDarkMode ? '#1a2d42' : '#f5f7fa';
      ctx.fillRect(0, 0, container.offsetWidth, container.offsetHeight);
      
      // SVG ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
      var svgData = new XMLSerializer().serializeToString(svg);
      var svgBlob = new Blob([svgData], { type: 'image/svg+xml;charset=utf-8' });
      var url = URL.createObjectURL(svgBlob);
      
      var img = new Image();
      img.onload = function() {
        ctx.drawImage(img, 0, 0, container.offsetWidth, container.offsetHeight);
        URL.revokeObjectURL(url);
        
        // ë‹¤ìš´ë¡œë“œ
        var link = document.createElement('a');
        var timestamp = new Date().toISOString().slice(0, 10);
        var title = currentSession ? currentSession.title : 'wordcloud';
        link.download = 'wordcloud_' + title + '_' + timestamp + '.png';
        link.href = canvas.toDataURL('image/png');
        link.click();
      };
      img.src = url;
    }
    
    // =============================================
    // ì„¤ì •
    // =============================================
    function toggleSettings() {
      var panel = document.getElementById('settingsPanel');
      panel.classList.toggle('active');
      
      // ì„¤ì • íŒ¨ë„ ì—´ë¦´ ë•Œ QR ì½”ë“œ ì—…ë°ì´íŠ¸
      if (panel.classList.contains('active') && currentSession) {
        var qrSection = document.getElementById('settingsQRSection');
        qrSection.style.display = 'block';
        
        var studentUrl = currentStudentUrl || '';
        if (studentUrl) {
          var qrApiUrl = 'https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=' + encodeURIComponent(studentUrl);
          document.getElementById('settingsQRCode').innerHTML = '<img src="' + qrApiUrl + '" alt="QR Code" style="width: 150px; height: 150px;">';
          document.getElementById('settingsSessionCode').textContent = currentSession.code;
        }
      }
    }
    
    function setTheme(theme) {
      currentTheme = theme;
      document.querySelectorAll('.color-option').forEach(function(el) {
        el.classList.remove('active');
      });
      document.querySelector('[data-theme="' + theme + '"]').classList.add('active');
      
      if (wordData.length > 0) {
        renderWordCloud({ words: wordData, total: wordData.reduce(function(sum, w) { return sum + w[1]; }, 0) });
      }
    }
    
    function setDisplayMode(mode) {
      isDarkMode = (mode === 'dark');
      
      if (isDarkMode) {
        document.body.classList.remove('light-mode');
        document.getElementById('btnDarkMode').classList.add('active');
        document.getElementById('btnLightMode').classList.remove('active');
      } else {
        document.body.classList.add('light-mode');
        document.getElementById('btnLightMode').classList.add('active');
        document.getElementById('btnDarkMode').classList.remove('active');
      }
      
      if (wordData.length > 0) {
        renderWordCloud({ words: wordData, total: wordData.reduce(function(sum, w) { return sum + w[1]; }, 0) });
      }
    }
    
    function updateFontSize() {
      fontSizeMultiplier = parseFloat(document.getElementById('fontSizeSlider').value);
      document.getElementById('fontSizeValue').textContent = fontSizeMultiplier.toFixed(1);
      
      if (wordData.length > 0) {
        renderWordCloud({ words: wordData, total: wordData.reduce(function(sum, w) { return sum + w[1]; }, 0) });
      }
    }
    
    function updateRefreshInterval() {
      refreshIntervalMs = parseInt(document.getElementById('refreshInterval').value);
      startAutoRefresh();
    }
    
    function updateWordList() {
      var container = document.getElementById('wordList');
      
      if (wordData.length === 0) {
        container.innerHTML = '<p style="color: var(--text-secondary); text-align: center;">ë°ì´í„° ì—†ìŒ</p>';
        return;
      }
      
      var html = '';
      var displayWords = wordData.slice(0, 20);
      for (var i = 0; i < displayWords.length; i++) {
        var word = displayWords[i][0];
        var count = displayWords[i][1];
        html += '<div class="word-item"><span class="word">' + escapeHtml(word) + '</span><span class="count">' + count + '</span></div>';
      }
      container.innerHTML = html;
    }
    
    // =============================================
    // ìë™ ìƒˆë¡œê³ ì¹¨
    // =============================================
    function startAutoRefresh() {
      stopAutoRefresh();
      refreshTimer = setInterval(function() {
        loadSession();
      }, refreshIntervalMs);
    }
    
    function stopAutoRefresh() {
      if (refreshTimer) {
        clearInterval(refreshTimer);
        refreshTimer = null;
      }
    }
    
    // =============================================
    // QR ëª¨ë‹¬
    // =============================================
    function showQRModal() {
      if (!currentSession) {
        alert('í™œì„±í™”ëœ ì„¸ì…˜ì´ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      
      // ì„œë²„ì—ì„œ ë°›ì€ URL ì‚¬ìš© (ì»¤ìŠ¤í…€ URL ë˜ëŠ” ê¸°ë³¸ URL)
      var studentUrl = currentStudentUrl;
      
      if (!studentUrl) {
        // fallback
        var baseUrl = window.location.href.split('?')[0];
        studentUrl = baseUrl + '?page=student&code=' + currentSession.code;
      }
      
      document.getElementById('modalSessionTitle').textContent = currentSession.title;
      document.getElementById('modalSessionCode').textContent = currentSession.code;
      document.getElementById('modalUrl').textContent = studentUrl;
      
      var qrApiUrl = 'https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=' + encodeURIComponent(studentUrl);
      document.getElementById('qrCode').innerHTML = '<img src="' + qrApiUrl + '" alt="QR Code">';
      
      document.getElementById('qrModal').classList.add('active');
    }
    
    function copyLink() {
      var url = document.getElementById('modalUrl').textContent;
      
      if (navigator.clipboard) {
        navigator.clipboard.writeText(url).then(function() {
          alert('ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
        });
      } else {
        var textarea = document.createElement('textarea');
        textarea.value = url;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
        alert('ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
      }
    }
    
    function closeModal(modalId) {
      document.getElementById(modalId).classList.remove('active');
    }
    
    // =============================================
    // ìœ í‹¸ë¦¬í‹°
    // =============================================
    function toggleFullscreen() {
      if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen();
      } else {
        document.exitFullscreen();
      }
    }
    
    function escapeHtml(text) {
      var div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
    
    function debounce(func, wait) {
      var timeout;
      return function() {
        var context = this, args = arguments;
        clearTimeout(timeout);
        timeout = setTimeout(function() {
          func.apply(context, args);
        }, wait);
      };
    }
    
    function handleError(error) {
      console.error(error);
      document.getElementById('loadingView').style.display = 'none';
      alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + (error.message || error));
    }
  </script>
</body>
</html>